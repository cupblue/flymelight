"use strict";function whichAnimationEvent(){var a,b=document.createElement("animelem"),c={transition:"animationend",OTransition:"oanimationend",MozTransition:"mozAnimationEnd",MSAnimation:"MSAnimationEnd",WebkitTransition:"webkitAnimationEnd"};for(a in c)if(void 0!==b.style[a])return c[a]}function index(a,b){for(var c=0,d=b.length;d>c;c++)if(b[c]===a)return c}function setCookie(a,b,c){var d=new Date;d.setDate(d.getDate()+c),document.cookie=a+"="+encodeURIComponent(b)+(null===c?"":";expires="+d.toGMTString())}function getCookie(a){var b,c;return document.cookie.length>0&&(b=document.cookie.indexOf(a+"="),-1!==b)?(b=b+a.length+1,c=document.cookie.indexOf(";",b),-1===c&&(c=document.cookie.length),decodeURIComponent(document.cookie.substring(b,c))):""}function getStorge(a){if(storage){if(null!==storage.getItem(a))return storage.getItem(a)}else if(document.cookie.length>0){var b=getCookie(a);return b}}function setStorge(a,b,c){storage?storage.setItem(a,b):setCookie(a,b,c)}function getPrz(a,b,c,d){var e="";$$.getJSON(e,{uid:a,sign:b},"callback",function(a){null==a&&(a={}),a.total=c,d&&d(a)})}function showRes(a){a={status:5,total:a.total,timesleft:0,result:"",percent:"12.7",creditsTotal:0,creditsConsume:0,shareDone:0,suc:0,przTit:"很遗憾~",przCont:"",tips:""},a={status:2,total:a.total,timesleft:0,result:"",percent:"52.7",creditsTotal:100,creditsConsume:20,shareDone:0,suc:1,przTit:"很遗憾~",przCont:"",tips:""};var b='<div class="popup-tit">游戏结束</div><div class="popup-cont">你打了 <i>'+a.total+"</i> 个僵尸，<br>战胜全宇宙 <i>"+a.percent+"%</i> 的小伙伴~<br>";b+=a.przCont?'同时还获得了：<br><img src="images/gift01.png" alt=""><br><span class="gift-name">'+a.przCont+"</span></div>":"本次未获奖，再接再厉哦！</span></div>",b+='<div class="popup-btn tc"><a href="javascript:;" class="btn-item"><img class="btn-showoff" src="images/show.png" alt="炫耀一下"></a><a href="index.html" class="btn-item"><img class="btn-back" src="images/back.png" alt="返回首页"></a></div>',setTimeout(function(){popupRes.innerHTML=b,popupObj.style.display="block"},1e3)}function setFlag(a){flag=a}function countdown(a,b){setFlag(!1);var c="",d=setInterval(function(){if(b--,c=10>b?"0"+b:b,a.innerHTML="00:"+c,0>=b){clearInterval(d),clearInterval(timer),setFlag(!0);var e=getStorge("total"),f=document.getElementById("uid"),g=document.getElementById("sign");setTimeout(function(){showRes({total:e})},2e3),getPrz(f,g,e,showRes)}},1e3)}function ghostPlay(a,b,c){for(var d=b.length,e=0;d>e;e++){var f=b[e]-1;a[f].className="ghost-item ghost-live"}setTimeout(function(){for(var c=0;d>c;c++){var e=b[c]-1;a[e].className="ghost-item"}},c/2)}function generateRadom(a){var b=a.length,c=[];if(b>0){for(var d=Math.floor(Math.random()*b/2+1),e=1;b>=e;e++)c.push(e);c=c.sort(function(){return Math.random()-.5}),c.splice(0,b-d)}return c}function playStart(a){var b=document.getElementById("chance");if(b||alert("没有机会了"),flag){var c=a.parentNode;c.style.display="none",overlayObj.style.display="none",document.getElementById("total").className="total bounce animated",document.getElementById("time").className="time bounce animated",total=0,setStorge("total",total,1),countdown(document.getElementById("countdown"),30),timer=setInterval(function(){var a=generateRadom(obj_item);ghostPlay(obj_item,a,1500)},1e3)}}function startCountAnimation(a,b,c){a.innerHTML=b,a.className=c}function stopCountAnimation(a,b,c){!animationEvent||"ontouchstart"in document.documentElement?setTimeout(function(){a.className=b},c):a.addEventListener(animationEvent,function(){this.className=b})}function kill(a){if(!flag&&"ghost-item ghost-live"===a.target.className){var b=(new Date).getTime(),c=index(a.target,obj_item);100>b-milliseconds&&c===k_index&&console.log(b+"-"+milliseconds),b-milliseconds>=100&&(a.target.className="ghost-item ghost-dead",total++,startCountAnimation(totalObj,total,"totalcount slidedown count-animated"),stopCountAnimation(totalObj,"totalcount",500),setStorge("total",total,1),k_index=c),milliseconds=b}}function layerHandler(a){var b=a.target;if("sharelayer"===b.className||"shareimg"===b.className){var c="block"===shareLayer.style.display?"none":"block";shareLayer.style.display=c,overlayObj.style.display=c}"startbtn"===b.className.toLowerCase()&&(playStart(b),overlayObj.style.display="none")}function popupHandler(a){var b=a.target;if("btn-showoff"===b.className.toLowerCase()){var c="block"===shareLayer.style.display?"none":"block";shareLayer.style.display=c,overlayObj.style.display="block"}}for(var $$={getJSON:function(a,b,c,d){a+="&"+c+"=jsonp"+Math.floor(1e6*Math.random());var e="",f=this.getQueryString(a)[c];for(var g in b)e+="&"+g+"="+encodeURIComponent(b[g]);a+=e,window[f]=function(a){window[f]=void 0;try{delete window[f]}catch(b){}h&&h.removeChild(i),d(a)};var h=document.getElementsByTagName("head")[0],i=document.createElement("script");return i.charset="UTF-8",i.src=a,i.async=!0,h.appendChild(i),!0},getQueryString:function(a){for(var b,c={},d=a&&-1!==a.indexOf("?")&&a.split("?")[1]||location.search.substring(1),e=/([^&=]+)=([^&]*)/g;b=e.exec(d);)c[decodeURIComponent(b[1])]=decodeURIComponent(b[2]);return c}},flag=!0,total=0,timer=null,milliseconds=0,k_index,storage=window.localStorage,obj_item=document.getElementById("ghost-list").getElementsByTagName("li"),totalObj=document.getElementById("totalcount"),overlayObj=document.getElementById("overlay"),popupObj=document.getElementById("popup"),popupRes=popupObj.firstElementChild||popupObj.firstChild,shareLayer=overlayObj.lastElementChild||overlayObj.lastChild,w=document.getElementById("wrap").clientWidth,h_window=document.documentElement.clientHeight,h_wrap=document.documentElement.clientWidth>=640?1080:h_window,w_item=Math.floor(w/3),h_item=Math.floor(248*w_item/235*1.3),top_area=Math.floor(370*w/720),i=0,len=obj_item.length;len>i;i++)obj_item[i].setAttribute("style","height:"+h_item+"px");document.getElementById("ghost-area").setAttribute("style","top:"+top_area+"px"),document.getElementById("wrap").setAttribute("style","height:"+h_wrap+"px");for(var evtType=("ontouchstart"in document.documentElement?"touchstart":"click"),k=0,klen=obj_item.length;klen>k;k++)obj_item[k].addEventListener(evtType,kill,!1);overlayObj.addEventListener(evtType,layerHandler,!1),popupObj.addEventListener(evtType,popupHandler,!1);